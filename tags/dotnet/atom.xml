<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="ru">
    <title>BaldMan - dotnet</title>
    <subtitle>Блог Николая Гущарина. Здесь можно найти статьи по .NET, создание системы умного дома, а так же про интересные инструменты для разработки.</subtitle>
    <link rel="self" type="application/atom+xml" href="https://baldman.justsquad.su/tags/dotnet/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://baldman.justsquad.su"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2025-04-18T00:00:00+00:00</updated>
    <id>https://baldman.justsquad.su/tags/dotnet/atom.xml</id>
    <entry xml:lang="ru">
        <title>Ускоряем работу C# Dictionary в 2 раза.</title>
        <published>2025-04-18T00:00:00+00:00</published>
        <updated>2025-04-18T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://baldman.justsquad.su/csharp-dictionary-speed-improvment/"/>
        <id>https://baldman.justsquad.su/csharp-dictionary-speed-improvment/</id>
        
        <content type="html" xml:base="https://baldman.justsquad.su/csharp-dictionary-speed-improvment/">&lt;p&gt;Давайте поговорим о том, как оптимизировать производительность типа &lt;code&gt;Dictionary&lt;&#x2F;code&gt; в C#.&lt;&#x2F;p&gt;
&lt;p&gt;Этот тип данных — один из самых популярных типов коллекций .NET, и его правильное использование может значительно улучшить производительность вашего приложения. Сначала рассмотрим немного теории работы словаря, а после познакомимся со способами ускорения методов вставки элементов.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;kak-rabotaet-dictionary&quot;&gt;Как работает Dictionary?&lt;&#x2F;h2&gt;
&lt;p&gt;Перед тем как перейти к оптимизации, давайте разберемся, как вообще работает &lt;code&gt;Dictionary&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Словарь представляет собой реализацию стандартной хеш-таблицы. Его суть работы состоит в том, чтобы однозначно связать ключ с его значением. И каждый раз когда мы делаем запрос по этому ключу, мы всегда должны получать одно и то же значение. Ключи могут быть как ссылочными, так и значимыми типами. Инициализация происходит либо при создании (если передана начальный размер коллекции), либо при добавлении первого элемента, причем в качестве размера будет выбрано ближайшее простое число. При этом создаются 2 внутренние коллекции — &lt;strong&gt;int[] buckets&lt;&#x2F;strong&gt; и &lt;strong&gt;Entry[] entries&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-class z-cs&quot;&gt;&lt;span class=&quot;z-storage z-type z-class z-cs&quot;&gt;class&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-class z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;IDictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-inherited-class z-cs&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;ICollection&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;KeyValuePair&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-inherited-class z-cs&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;IEnumerable&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;KeyValuePair&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-inherited-class z-cs&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;IEnumerable&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-inherited-class z-cs&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;IDictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-inherited-class z-cs&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;ICollection&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-inherited-class z-cs&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;IReadOnlyDictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-inherited-class z-cs&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;IReadOnlyCollection&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;KeyValuePair&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-inherited-class z-cs&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;ISerializable&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-inherited-class z-cs&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;IDeserializationCallback&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;where&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;notnull&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;  &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-cs&quot;&gt;    &lt;span class=&quot;z-keyword z-other z-preprocessor z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-preprocessor z-cs&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-invalid z-illegal z-cs&quot;&gt;nullable disable&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;int&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-cs&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-cs&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_buckets&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;Entry&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;[] &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_entries&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;ulong&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_fastModMultiplier&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_count&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_freeList&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_freeCount&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_version&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;IEqualityComparer&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_comparer&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;KeyCollection&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_keys&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;ValueCollection&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;_values&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Первая будет содержать индексы элементов во второй коллекции, а она, в свою очередь, сами элементы в таком виде:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-struct z-cs&quot;&gt;&lt;span class=&quot;z-storage z-type z-struct z-cs&quot;&gt;struct&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-struct z-cs&quot;&gt;Entry&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-struct z-cs&quot;&gt;   &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-struct z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;     &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;uint&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;hashCode&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-struct z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;     &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;next&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-struct z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;     &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-struct z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;     &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-member z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-struct z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;   &lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;При добавлении элемента вычисляется хэшкод его ключа и затем — индекс корзины в которую он будет добавлен по модулю от величины коллекции. Затем проверяется нет ли уже такого ключа в коллекции, если есть — то операция Add выбросит исключение, а присваивание по индексу просто заменит элемент на новый.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; выбросит исключение
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;Add&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-cs&quot;&gt;10&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-cs&quot;&gt;20&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; просто подменит значение на новое
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-cs&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-cs&quot;&gt;10&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-cs&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-cs&quot;&gt;20&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Если достигнут максимальный размер словаря, то происходит расширение (выбирается новый размер в 2 раза больше предыдущего, и округляется до ближайшего простого числа). Дальше старый словарь полностью копируется в новое выделенное место. А старая область памяти будет подвержена сборки мусора. Сложность такой операции будет соответственно — O(n).&lt;&#x2F;p&gt;
&lt;p&gt;Если происходит коллизия (в корзине индексов &lt;code&gt;_buckets&lt;&#x2F;code&gt; уже есть элемент), то новый элемент добавляется в коллекцию, его индекс сохраняется в корзине, а индекс старого элемента — в его поле next.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;baldman.justsquad.su&#x2F;csharp-dictionary-speed-improvment&#x2F;.&#x2F;images&#x2F;image_1.png&quot; alt=&quot;Пример работы с колизией&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;В результате мы получаем односвязный список относительно дублируемого ключа хеширования. Данный механизм разрешения коллизий называется &lt;strong&gt;chaining&lt;&#x2F;strong&gt;. Чтобы предотвратить такое поведение, необходимо выбирать такой алгоритм в методе &lt;code&gt;GetHashCode&lt;&#x2F;code&gt;, который будет давать максимально уникальные значения.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;problema-dvoinogo-kheshirovaniia&quot;&gt;Проблема двойного хеширования&lt;&#x2F;h2&gt;
&lt;p&gt;Предположим, необходимо выполнить вставку в словарь какого-либо значения, но перед этим проверить, если ключ уже существует, то вернуть то значение которое уже было записано:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-if z-cs&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-cs&quot;&gt;!&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;ContainsKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-cs&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-cs&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-language z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;На первый взгляд, это кажется логичным решением. Но проблема заключается в том, что здесь происходит &lt;strong&gt;двойное хеширование&lt;&#x2F;strong&gt;:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;При вызове &lt;code&gt;ContainsKey&lt;&#x2F;code&gt; вычисляется хеш для проверки существования ключа.&lt;&#x2F;li&gt;
&lt;li&gt;При добавлении элемента снова вычисляется хеш.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Это приводит к дополнительной нагрузке, особенно если такая операция выполняется в цикле или в горячих путях программы.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;reshenie-problemy-cherez-trygetvalue&quot;&gt;Решение проблемы через TryGetValue&lt;&#x2F;h2&gt;
&lt;p&gt;Одним из способов минимизировать эту проблему является использование метода &lt;code&gt;TryGetValue&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-if z-cs&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-cs&quot;&gt;!&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;TryGetValue&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-argument z-cs&quot;&gt;out&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;_&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-cs&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-cs&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-language z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Этот подход позволяет избежать явного вызова &lt;code&gt;ContainsKey&lt;&#x2F;code&gt;, но все равно требует двух обращений к словарю:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Проверка наличия ключа.&lt;&#x2F;li&gt;
&lt;li&gt;Добавление значения.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Например, у класса ConcurrentDictionary есть метод GetOrAdd, который лишен проблемы с двойным доступом к словарю.&lt;&#x2F;p&gt;
&lt;p&gt;Как можно упростить работу и сохранить функционал? Для начала можно обернуть двойной доступ в отдельный метод GetOrAdd и там разместить методы по добавлению значения.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-class z-cs&quot;&gt;&lt;span class=&quot;z-storage z-type z-class z-cs&quot;&gt;class&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-class z-cs&quot;&gt;DictionaryExtensions&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-cs&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-cs&quot;&gt;GetOrAdd&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-parameter z-cs&quot;&gt;this&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-function z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-function z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;        &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;where&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;notnull&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-conditional z-if z-cs&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-cs&quot;&gt;!&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;TryGetValue&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-argument z-cs&quot;&gt;out&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;existedValue&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;        &lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;            &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-cs&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-cs&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-language z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;            &lt;span class=&quot;z-keyword z-control z-flow z-return z-cs&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-language z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;        &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;       
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-flow z-return z-cs&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;existedValue&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Но это не решает проблему. Мы все равно делаем две операции доступа по ключу.&lt;&#x2F;p&gt;
&lt;p&gt;Можно ли сделать лучше?&lt;&#x2F;p&gt;
&lt;h2 id=&quot;effektivnoe-reshenie-cherez-collectionmarshal&quot;&gt;Эффективное решение через CollectionMarshal&lt;&#x2F;h2&gt;
&lt;p&gt;Да, можно! В современном .NET есть класс &lt;code&gt;System.Runtime.InteropServices.CollectionsMarshal&lt;&#x2F;code&gt;, который предоставляет метод &lt;code&gt;TryGetValueRefOrAddDefault&lt;&#x2F;code&gt;. Он позволяет получить ссылку на значение по ключу или добавить значение за одно обращение к словарю. Вот пример использования:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-cs&quot;&gt;using&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-cs&quot;&gt;System&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-namespace z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-cs&quot;&gt;Runtime&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-namespace z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-cs&quot;&gt;InteropServices&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-cs&quot;&gt;GetOrAdd&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-parameter z-cs&quot;&gt;this&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-function z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-function z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;defaultValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;ArgumentNullException&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;ThrowIfNull&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;var&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-variable z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;CollectionsMarshal&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;GetValueRefOrAddDefault&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-argument z-cs&quot;&gt;out&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;bool&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;exists&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-conditional z-if z-cs&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;exists&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-flow z-return z-cs&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-cs&quot;&gt;!&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-language z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-flow z-return z-cs&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-language z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Этот метод доступен начиная с .NET 6 и выше. Он особенно полезен, когда вам нужно выполнять операции &quot;получить или добавить&quot; в высокопроизводительных частях кода.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;rasshirenie-funktsional-nosti&quot;&gt;Расширение функциональности&lt;&#x2F;h2&gt;
&lt;p&gt;Кроме &lt;code&gt;GetOrAdd&lt;&#x2F;code&gt;, вы можете реализовать другие полезные методы для словарей, например:&lt;&#x2F;p&gt;
&lt;h3 id=&quot;tryupdate&quot;&gt;TryUpdate&lt;&#x2F;h3&gt;
&lt;p&gt;Метод &lt;code&gt;TryUpdate&lt;&#x2F;code&gt; позволяет обновить значение по ключу, если ключ уже существует:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;bool&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-cs&quot;&gt;TryUpdate&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-parameter z-cs&quot;&gt;this&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-function z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-function z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;where&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;notnull&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;ArgumentNullException&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;ThrowIfNull&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;var&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-variable z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;CollectionsMarshal&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;GetValueRefOrNullRef&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-conditional z-if z-cs&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;Unsafe&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;IsNullRef&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-argument z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-flow z-return z-cs&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-cs&quot;&gt;false&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-language z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-flow z-return z-cs&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-cs&quot;&gt;true&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Таким же образом можно создать другие методы расширения для словарей, например:&lt;&#x2F;p&gt;
&lt;h3 id=&quot;removeifexists&quot;&gt;RemoveIfExists&lt;&#x2F;h3&gt;
&lt;p&gt;Позволяет удалить ключ, если он существует.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;bool&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-cs&quot;&gt;RemoveIfExists&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-parameter z-cs&quot;&gt;this&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-function z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;where&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;notnull&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;ArgumentNullException&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;ThrowIfNull&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Получаем ссылку на значение по ключу или null, если ключа нет
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;var&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-variable z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;CollectionsMarshal&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;GetValueRefOrNullRef&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Если ссылка не является null, значит ключ существует
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-conditional z-if z-cs&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;Unsafe&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;IsNullRef&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-argument z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-flow z-return z-cs&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-cs&quot;&gt;false&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Ключ не существует, ничего не делаем
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;Remove&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Удаляем ключ
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-flow z-return z-cs&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-cs&quot;&gt;true&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Возвращаем true, так как ключ был удален
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;upsert&quot;&gt;Upsert&lt;&#x2F;h3&gt;
&lt;p&gt;Позволяет обновить значение, если ключ существует, или добавить новое значение.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-access z-cs&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;void&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-cs&quot;&gt;Upsert&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-parameter z-cs&quot;&gt;this&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-function z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-function z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TValue&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;where&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;TKey&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-other z-inherited-class z-cs&quot;&gt;notnull&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-cs&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-cs&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;ArgumentNullException&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;ThrowIfNull&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Получаем ссылку на значение по ключу или default(TValue), если ключа нет
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-cs&quot;&gt;var&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-variable z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-cs&quot;&gt;ref&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;CollectionsMarshal&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;GetValueRefOrAddDefault&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-argument z-cs&quot;&gt;out&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;_&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Если ключ существует, обновляем значение
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Если же не существует, то добавляем значение
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;    &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;slot&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-language z-cs&quot;&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-cs&quot;&gt;&lt;span class=&quot;z-meta z-block z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-cs&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;prakticheskii-primer&quot;&gt;Практический пример&lt;&#x2F;h2&gt;
&lt;p&gt;Давайте рассмотрим практический пример использования этих методов:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cs&quot; class=&quot;language-cs z-code&quot;&gt;&lt;code class=&quot;language-cs&quot; data-lang=&quot;cs&quot;&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-cs&quot;&gt;var&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-variable z-cs&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-instance z-cs&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-new z-cs&quot;&gt;new&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-instance z-cs&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-instance z-cs&quot;&gt;&lt;span class=&quot;z-support z-type z-cs&quot;&gt;Dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-cs&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-storage z-type z-cs&quot;&gt;int&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-cs&quot;&gt;string&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-cs&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-instance z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;GetOrAdd&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-cs&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-cs&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Value1&lt;span class=&quot;z-punctuation z-definition z-string z-end z-cs&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;TryUpdate&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-cs&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-argument z-cs&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-cs&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;UpdatedValue1&lt;span class=&quot;z-punctuation z-definition z-string z-end z-cs&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;Console&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;WriteLine&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;JsonSerializer&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-cs&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-variable z-function z-cs&quot;&gt;Serialize&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-cs&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-cs&quot;&gt;&lt;span class=&quot;z-meta z-group z-cs&quot;&gt;&lt;span class=&quot;z-variable z-other z-cs&quot;&gt;dictionary&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-cs&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-cs&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-cs&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-cs&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; {&amp;quot;1&amp;quot;:&amp;quot;UpdatedValue1&amp;quot;}
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Как видите, эти методы делают работу со словарем более эффективной и чистой.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;zakliuchenie&quot;&gt;Заключение&lt;&#x2F;h2&gt;
&lt;p&gt;Подведем итоги:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Использование &lt;code&gt;ContainsKey&lt;&#x2F;code&gt; и &lt;code&gt;TryGetValue&lt;&#x2F;code&gt; может быть неэффективным из-за двойного хеширования.&lt;&#x2F;li&gt;
&lt;li&gt;Методы &lt;code&gt;CollectionsMarshal&lt;&#x2F;code&gt; позволяют оптимизировать работу со словарями.&lt;&#x2F;li&gt;
&lt;li&gt;Создание своих методов расширения поможет сделать ваш код более удобным и производительным.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Дополнительные источники:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;just-squad&#x2F;just-platform-dotnet&#x2F;blob&#x2F;main&#x2F;src&#x2F;JustPlatform.Extensions&#x2F;DictionaryExtensions.cs&quot;&gt;Ссылка на проект с исходным кодом&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=6CWQXQISYpk&quot;&gt;YouTube видео&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
</feed>
