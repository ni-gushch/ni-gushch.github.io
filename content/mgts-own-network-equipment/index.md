+++
title = "Замена сетевого оборудования МГТС на собственное."
description = "Хотите заменить роутер провайдера МГТС и не знаете на что? Прочитайте статью, тут есть некоторые ответы."
date = 2024-12-27
draft = false

[taxonomies]
tags = ["mgts","network", "mikrotik", "keenetic"]
[extra]
keywords = "mgts, мгтс, mikrotik, network, keenetic"
#thumbnail = "ferris-gesture.png"
#toc = true
series = "network"
+++

**Obsidian** очень удобный инструмент для работы с заметками разного рода. Можно составлять просто список дел на день, а некоторые люди пишут сценарии или наброски книг. 

Но при его использовании встает вопрос о синхронизации данных. Конечно, можно использовать функционал облака от разработчиков Obsidian, но иногда хочется получить независимость от "корпораций". И **Obsidian** может предоставить такой вариант.

Есть два способа. Уставить локальный сервер синхронизации, который использует CouchDB, либо можно воспользоваться системой контроля версий Git. 

В этой статье пойдет речь о том, как реализовать синхронизацию хранилища через Git на Android устройствах.

## Подготовительный этап

Для реализации любого способа нам обязательно нужен репозиторий, в нем будут храниться все документы. Для этого заходим туда, где будем создавать репозиторий (GitLab, GitHub....) логинимся и создаем пустой приватный репозиторий. Для того, чтобы автоматически создалась ветка, можно добавить сразу в репозиторий файл `.gitignore`.

![github_repo](./images/img_1.jpg)

Дальше нам как то нужно клонировать этот репозиторий к себе на Android устройство. Так как встроенной поддержки командной строки в Android нет, то нам придется воспользоваться сторонним приложением, которое будет эмулировать работу командной строки `Unix` системы.

### Установка Termux и настройка git

**Termux** - приложение с открытым исходным кодом, которое предназначено для эмуляции командной строки Linux, с поддержкой пакетного менеджера. Скачать это приложение можно как из [Google Play](https://play.google.com/store/apps/details?id=com.termux&hl=ru) так и из альтернативного магазина [F-Droid](https://f-droid.org/packages/com.termux/), в котором содержатся только приложения с открытым исходным кодом. За дополнительной информацией можно обратиться на их официальную [Wiki страничку](https://wiki.termux.com/wiki/Installation)

Теперь запускаем приложение у начинаем устанавливать необходимые пакеты.

```sh
pkg update && pkg upgrade -y && pkg install -y git openssh termux-api
```

Теперь определим в какой папке будут расположены репозитории Vaults. Для примера определим папку `repos` в папке `Documents` и создадим ее.

```sh
mkdir ~/storage/shared/Documents/repos \
mkdir ~/storage/shared/Documents/repos/obsidian/
cd ~/storage/shared/Documents/repos/obsidian
```

И теперь нам нужно клонировать репозиторий в созданную папку.

Если бы у нас репозиторий был публичный, то проблем бы не было. Но у нас он приватный, и чтобы клонировать нам нужно пройти авторизацию. 

Для GitHub можно воспользоваться их фирменным CLI-приложением `gh`. Чтобы ее установить нужно выполнить команду.

```sh
apt install gh
```

Для авторизации на сайте можно использовать 

```sh
gh login
```

Нужно будет выбрать способ прохождения авторизации. Я обычно выбираю через браузер... после выбора параметров вас перебросит в браузер, где нужно будет ввести дополнительно код, сгенерированный в консоли.

После подключения можно будет забирать ссылку такого вида:

![repo_link](./images/img_2.jpg)

и, выполняя ее в консоли Termux, репозиторий будет клонирован в ту папку в которой мы сейчас находимся.

```sh
gh repo clone <repo-link>
```

### Добавление хранилища в Obsidian

После клонирования репозитория мы может добавить эту папку как хранилище в Obsidian

Если вы только скачали само приложение, на стартовом экране у вас появится кнопка "Выбор папки для хранилища". Нажав ее, укажите ту папку, в которая была создана в результате клонирования репозитория.

Теперь все добавляемые файлы будут индексироваться `git` и их можно отправлять в удаленный репозиторий.

С подготовительным этапом закончили. Теперь рассмотрим способы именно синхронизации.

## Использование расширения Git

Самый простой способ. Он работает на любом устройстве, но разработчики пишут, что на мобильных устройствах может работать крайне не стабильно. Потому что расширение не может использовать нативные команды git CLI, а использует библиотеку JavaScript, которая каким то образом тоже умеет работать с Git.

У меня получилось запустить его не с первого раза. Но после удачной попытки настроить синхронизацию через командную строку, расширение заработало. Я думаю, что это было просто совпадение. Давайте пойдем по шагам.

### Установка расширения.

Плагин разрабатывается сообществом, и поэтому его нет в составе `CorePlugins`, и поэтому нужно сначала включить поддержку `Community plugins`. Для этого нажмите на шестеренки в правом верхнем углу меню.

![obs-1](./images/img_3.jpg) 

После включаем поддержку `Community plugins` как показано на рисунке.

![obs-2](./images/img_5.png)

Дальше нажимаем на просмотр списка доступных расширений

![obs-3](./images/img_6.png)

И ищем среди списка расширение с названием `Git`

![obs-4](./images/img_7.png)

Нажимаем на это расширение -> Установить -> Активировать. Кнопка активировать будет там, где на картинке кнопка "отключить"

![obs-5](./images/img_8.png)

Далее переходим в настройки плагина. Я установил время автоматического обновления репозитория. Коммит изменений каждые 2 минуты, просмотр обновлений каждые 5 минут. Так как мы все таки работаем одновременно на 1м устройстве, то не обязательно делать прям мгновенное обновление

![obs-5](./images/img_9.png)

Включаем проверку обновления при старте приложения. Push изменений после локальной фиксации. И обновление локального репозитория перед отправкой в удаленный (Pull before Push).

![obs-6](./images/img_10.png)

Так же обязательно нужно ввести свой логин, пароль (Public Access Token для GitHub, его можно получить в настройках пользователя GitHub). А так же обязательно вводим имя пользователя и почту для пользователя Git.

![obs-7](./images/img_11.png)

Теперь у вас будет автоматически обновляться репозиторий хранилища. И вы можете заметить что будут автоматически появляться всплывающие окна, с описанием действия синхронизации.

## Использование Termux эмулятора

Для реализации этого подхода, у нас вообще почти все готово. Единственное что нужно сделать это прописать имя пользователя и адрес электронной почти, а так же прописать ssh ключ для синхронизации. Заходим в приложение Termux и запускаем команды:

```sh
git config --global user.name <name>
git config --global user.email <email>
```

Чтобы получить ssh ключ пропишем в командной стоке

```sh 
cat ~/.ssh/id_rsa.pub
```

Скопировать то, что вывелось в результате команды, идем в настройки пользователя GitHub или другого репозитория и настройках пользователя добавляем SSH ключ авторизации.

Минус этого подхода в том, что тут не будет никакой автоматики, и придется прописывать все команды вручную. Но зато, все будет точно работать :D

Заходим в папку где находится наше хранилище

```sh
cd ~/storage/Documents/repos/obsidian/my-obsidian-vault-repo
```

Обновляем индекс удаленного репозитория

```sh
git fetch --prune
git pull
```

> Заметка, чтобы постоянно не использовать `prune` для очистки локального индекса, можно использовать глобальную настройку
> ```sh
> git config remote.origin.prune true
> ```

После синхронизации локальной копии с удаленной, и добавления новых файлов можно отправить эти изменения в удаленный репозиторий. Для этого выполним следующее:

```sh
git add .
git commit -m <message>
git push
```

Вот так вручную можно обновлять данные в удаленном репозитории. Но этот способ не такой удобный. Давайте попробуем его улучшить.

## Использование Termux и отдельного планировщика Tasker

Если вы выполняли пункты прописанные ранее, то можно начать вот [ЭТУ](https://github.com/DovieW/obsidian-android-sync/blob/master/README.md) инструкцию с 7 шага, раздела **Termux Setup**

Только в нашей ситуации папка в которую будет клонирован скрипт будет чуть другой

```sh
git clone https://github.com/DovieW/obsidian-android-sync.git ~/storage/shared/Documents/repos/obsidian/obsidian-android-sync
```

**Плюс** этого метода - потенциальная автоматизация, если в четкость пройти все настроки. Если же не получится поработать с приложением Tasker, то останется скриптик, который можно вызывать для синхронизации хранилища. 

```sh
./sync-vaults.sh
```

Этот скрипт автоматически подтянет изменения из удаленного репозитория, сделаем коммит, и отправит коммит в удаленный репозиторий.

**Минус** этого подхода - приложение **Tasker** - ПЛАТНОЕ!!! а зачем нам использовать синхронизацию собственными руками, так еще и платить за приложение. Но если оно уже у вас есть, то этот способ для вас.

## Использование Termux и планировщика cron

Есть еще один способ, который просто является альтернативой для предыдущего. В этом варианте мы подменяем приложение Tasker на возможности cron scheduler. Запускать и управлять им можно прям в самом **Termux**.

Для реализации такого подхода можно воспользоваться [этой инструкцией](https://www.reddit.com/r/ObsidianMD/comments/qep4gn/guide_obsidian_vault_github_sync_cron_on_termux/). Но в качестве скрипта можно использовать тот, который мы получили в результате предыдущего способа.

С помощью cron можно очень гибко настроить время синхронизации. 

На этом все. Мы рассмотрели несколько способов реализации синхронизации хранилища через Git репозиторий.

Если остались вопросы, то можно их задать под постами в [tg канале](https://t.me/bald_man_gushcharin).