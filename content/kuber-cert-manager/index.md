+++
title = "Получение сертификатов в k3s (k8s) через cert manager."
description = "Способ автоматизировать процесс получения сертификатов для локального контура с использованием cert manager и DNS01 challenge."
date = 2025-02-12
draft = false

[taxonomies]
tags = ["kubernetes","k3s", "k8s", "certmanager", "letsencrypt"]
[extra]
keywords = "kubernetes, k3s, k8s, cert-manager, letsencrypt"
#thumbnail = "ferris-gesture.png"
#toc = true
series = "kubernetes"
+++

Наличие SSL сертификатов в наше время является неотъемлемой частью безопасности разворачиваемых ресурсов. А когда я занялся организацией своего сервера и поднял k3s кластер, то сразу задумался о том, как обеспечить Web сервисы валидными сертификатами.

Есть несколько путей получения желаемого результата. Например можно создавать самоподписыне сертификаты. Но в этой ситуации придется прописывать на каждом браузере, на каждом устройстве параметры доверенного центра сертификации. На стационарных машинах (ПК, ноутбуки) это сделать не так сложно, но вот добавление этой информации на мобильные устройства вызывает затруднение. А если захочется вывести сервис в "открытый интернет", то самоподписные сертификаты не будут вызывать доверия у пользователей. Так что для нас этот вариант не подходит.

Другой вариант, можно использовать утилиту `certbot`. Она позволит в автоматическом порядке получить сертификат LetsEncrypt под указанный домен. Так же можно получить wildcart сертификат, который будет доступен для все возможные вариации указанного домена. Например мы получаем ssl для `example.com` и он доступен только для него, если же мы получаем ssl для `*.example.com`, то мы сможем использовать этот сертификат как для `one.example.com`, так и для `two.example.com` и даже для `one.two.example.com`. Есть специальные утилиты, которые позволяют автоматически прописывать полученные сертификаты в конфигурацию web сервера nginx. Этот вариант хорош, и вполне себе используемый, но у него все же есть некоторые ограничения. Контролировать и перевыпускать сертификаты придется самостоятельно. Да, у LetsEncrypt была система оповещения о сроке окончания сертификата, но начиная с февраля 2025 года она закрывают поддержку этого функционала. Можно еще самостоятельно написать утилиту для автоматического отслеживания и обновления или найти ее на просторах интернета. Но я хотел, чтобы все работало из коробки. Да, я ленивый инженер. И еще один момент. Мы развернули k3s кластер, и через certbot пришлось бы специфиным образом подкидывать сертификаты к ingress-ам.

И есть еще один вариант, который можно изящно использовать в среде kubernates. Это использование сервиса `cert-manager`.


